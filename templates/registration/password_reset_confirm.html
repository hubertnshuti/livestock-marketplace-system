{% extends 'base.html' %}
{% block title %}Set New Password - ItungoHub{% endblock %}

{% block content %}
<div class="container d-flex align-items-center justify-content-center" style="min-height: 80vh;">
    <div class="col-12 col-md-8 col-lg-5">
        <div class="card shadow-lg border-0 rounded-4">
            <div class="card-body p-4 p-md-5">
                
                <div class="text-center mb-4">
                    <div class="bg-success-subtle text-success rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 64px; height: 64px;">
                        <i class="fas fa-key fa-2x"></i>
                    </div>
                    <h3 class="fw-bold text-dark">Set New Password</h3>
                    <p class="text-muted small">Please enter your new password below.</p>
                </div>
                
                {% if validlink %}
                    <form method="post">
                        {% csrf_token %}
                        {% for field in form %}
                            <div class="mb-3">
                                <label class="form-label fw-bold small text-uppercase text-muted">{{ field.label }}</label>
                                
                                {{ field }}
                                
                                {% if field.help_text %}
                                    <small class="text-muted d-block mt-1">{{ field.help_text }}</small>
                                {% endif %}
                                {% for error in field.errors %}
                                    <small class="text-danger d-block mt-1"><i class="fas fa-exclamation-triangle me-1"></i>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endfor %}
                        
                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-success btn-lg fw-bold rounded-3 shadow-sm">Change Password</button>
                        </div>
                    </form>
                {% else %}
                    <div class="alert alert-danger d-flex align-items-center" role="alert">
                        <i class="fas fa-exclamation-circle me-3 fs-4"></i>
                        <div>
                            <strong>Link Expired</strong><br>
                            The password reset link was invalid or has already been used.
                        </div>
                    </div>
                    <div class="d-grid">
                        <a href="{% url 'password_reset' %}" class="btn btn-primary fw-bold">Request New Reset</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Find all inputs on the page
        document.querySelectorAll('input').forEach(input => {
            // 1. Make them look good (Bootstrap style)
            input.classList.add('form-control', 'form-control-lg', 'bg-light');

            // 2. If it's a password field, add the Magic Eye
            if (input.type === "password") {
                
                // Create a wrapper div to hold the input + icon
                const wrapper = document.createElement('div');
                wrapper.classList.add('position-relative');
                
                // Insert wrapper before the input, then move input inside it
                input.parentNode.insertBefore(wrapper, input);
                wrapper.appendChild(input);

                // Add padding so text doesn't hit the icon
                input.style.paddingRight = '45px';

                // Create the icon element
                const iconSpan = document.createElement('span');
                iconSpan.classList.add('position-absolute', 'top-50', 'end-0', 'translate-middle-y', 'me-3');
                iconSpan.style.cursor = 'pointer';
                iconSpan.style.zIndex = '10';
                iconSpan.innerHTML = '<i class="fas fa-eye text-muted"></i>';

                // Add Click Logic
                iconSpan.addEventListener('click', function() {
                    const icon = this.querySelector('i');
                    if (input.type === 'password') {
                        input.type = 'text';
                        icon.classList.remove('fa-eye');
                        icon.classList.add('fa-eye-slash'); // "Slash" means hide
                    } else {
                        input.type = 'password';
                        icon.classList.remove('fa-eye-slash');
                        icon.classList.add('fa-eye'); // "Eye" means show
                    }
                });

                // Add the icon to the wrapper
                wrapper.appendChild(iconSpan);
            }
        });
    });
</script>
{% endblock %}